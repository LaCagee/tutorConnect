<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TutorConnect - Registro</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="auth-container">
    <div class="auth-card" style="max-width: 600px;">
      <h1 class="auth-title">üìù Crear Cuenta</h1>
      
      <div id="message" style="display: none;"></div>

      <form id="registerForm">
        <div class="form-group">
          <label for="nombre">Nombre Completo</label>
          <input 
            type="text" 
            id="nombre" 
            placeholder="Juan P√©rez" 
            required
          >
        </div>

        <div class="form-group">
          <label for="email">Email Institucional</label>
          <input 
            type="email" 
            id="email" 
            placeholder="tu.email@santotomas.cl" 
            required
          >
        </div>

        <div class="form-group">
          <label for="password">Contrase√±a</label>
          <input 
            type="password" 
            id="password" 
            placeholder="M√≠nimo 6 caracteres" 
            required
            minlength="6"
          >
        </div>

        <div class="form-group">
          <label>¬øQu√© tipo de usuario eres?</label>
          <div class="radio-group">
            <label>
              <input type="radio" name="rol" value="estudiante" checked>
              Estudiante
            </label>
            <label>
              <input type="radio" name="rol" value="tutor">
              Tutor
            </label>
          </div>
        </div>

        <!-- Campos adicionales para tutores (ocultos por defecto) -->
        <div id="tutorFields" class="hidden">
          <div class="form-group">
            <label>Asignaturas que ense√±as</label>
            <div class="checkbox-group" style="flex-direction: column;">
              <label><input type="checkbox" value="Matem√°ticas"> Matem√°ticas</label>
              <label><input type="checkbox" value="F√≠sica"> F√≠sica</label>
              <label><input type="checkbox" value="Qu√≠mica"> Qu√≠mica</label>
              <label><input type="checkbox" value="Programaci√≥n"> Programaci√≥n</label>
              <label><input type="checkbox" value="Ingl√©s"> Ingl√©s</label>
              <label><input type="checkbox" value="Estad√≠stica"> Estad√≠stica</label>
            </div>
          </div>

          <div class="form-group">
            <label for="precioPorHora">Precio por Hora (CLP)</label>
            <input 
              type="number" 
              id="precioPorHora" 
              placeholder="5000" 
              min="0"
            >
          </div>

          <div class="form-group">
            <label for="bio">Descripci√≥n / Experiencia</label>
            <textarea 
              id="bio" 
              placeholder="Cu√©ntanos sobre tu experiencia como tutor..."
            ></textarea>
          </div>
        </div>

        <button type="submit" class="btn btn-primary btn-full">
          Crear Cuenta
        </button>
      </form>

      <div class="auth-link">
        ¬øYa tienes cuenta? <a href="index.html">Inicia sesi√≥n aqu√≠</a>
      </div>
    </div>
  </div>

  <script src="js/auth.js"></script>
  <script>
    // Mostrar/ocultar campos de tutor seg√∫n selecci√≥n
    const radioButtons = document.querySelectorAll('input[name="rol"]');
    const tutorFields = document.getElementById('tutorFields');

    radioButtons.forEach(radio => {
      radio.addEventListener('change', (e) => {
        if (e.target.value === 'tutor') {
          tutorFields.classList.remove('hidden');
        } else {
          tutorFields.classList.add('hidden');
        }
      });
    });

    // Manejar el formulario de registro
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      clearMessages('message');

      const nombre = document.getElementById('nombre').value;
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const rol = document.querySelector('input[name="rol"]:checked').value;

      // Validar email institucional
      /*
      if (!email.endsWith('@santotomas.cl')) {
        showError('message', 'Debes usar un email institucional (@santotomas.cl)');
        return;
      }*/

      // Preparar datos del usuario
      const userData = {
        nombre,
        email,
        password,
        rol
      };

      // Si es tutor, agregar campos adicionales
      if (rol === 'tutor') {
        const asignaturas = [];
        document.querySelectorAll('#tutorFields input[type="checkbox"]:checked').forEach(cb => {
          asignaturas.push(cb.value);
        });

        if (asignaturas.length === 0) {
          showError('message', 'Debes seleccionar al menos una asignatura');
          return;
        }

        userData.asignaturas = asignaturas;
        userData.precioPorHora = document.getElementById('precioPorHora').value || 0;
        userData.bio = document.getElementById('bio').value || '';
      }

      try {
        await register(userData);
        showSuccess('message', '¬°Cuenta creada exitosamente! Redirigiendo al login...');
        
        // Redirigir al login despu√©s de 2 segundos
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 2000);
      } catch (error) {
        showError('message', error.message);
      }
    });
  </script>
</body>
</html>